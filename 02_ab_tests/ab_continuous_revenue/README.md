# A/B тест: влияние фичи на revenue

## 1) Задача
Проверить, изменила ли новая версия (test) средний доход на пользователя (`revenue`) по сравнению с контрольной группой (control)

## 2) Данные
В датасете по каждому пользователю есть:
- `user_id` — идентификатор пользователя
- `group` — группа эксперимента (`control` или `test`)
- `revenue` — доход на пользователя

Единица наблюдения — пользователь (один пользователь должен учитываться один раз)

## 3) Гипотезы
- **H0:** средний revenue в test и control одинаковый
- **H1:** средний revenue в test и control отличается

Уровень значимости: **0.05**.

## 4) Что проверил перед расчётами (качество данных)
Сделал базовые проверки, чтобы сравнение групп было корректным:
- баланс групп (сколько пользователей в каждой группе)
- пропуски в данных
- дубли пользователей (`user_id`) и то, что один пользователь не попадает в разные группы

Если находились дубли, приводил данные к формату **1 пользователь = 1 строка**

## 5) Как считал эффект
Посчитал средний `revenue` отдельно по группам и эффект:
- `mean_control` — средний revenue в control
- `mean_test` — средний revenue в test
- **эффект (delta)** = `mean_test - mean_control`

Итоговые значения:
- mean_control = **3.486**
- mean_test = **3.605**
- delta = **0.118**

## 6) Проверка статистической значимости
Чтобы понять, можно ли доверять разнице средних, использовал t-тест

Результаты:
- p-value = **0.541**
- 95% доверительный интервал для delta = **[-0.262; 0.499]**

Интерпретация:
- если p-value > 0.05, то доказательств влияния фичи нет
- если доверительный интервал пересекает 0, то нельзя уверенно сказать, что эффект точно положительный или точно отрицательный

## 7) Дополнительные проверки (распределение и выбросы)
Revenue часто имеет “длинный хвост”: бывают редкие очень большие значения, которые сильно влияют на среднее
Поэтому дополнительно посмотрел:
- гистограммы распределения revenue по группам
- boxplot по группам
- max и 99-й перцентиль (p99), чтобы оценить хвост числами

Также сделал проверку устойчивости:
- ограничил revenue сверху общим порогом `cap` на уровне p99
- пересчитал средние и delta на “основной массе” пользователей (без верхнего 1%)

Смысл этой проверки: понять, не держится ли разница средних на редких больших значениях

## 8) Итоговый вывод
По результатам эксперимента:
- статистически значимого эффекта на revenue **не обнаружено** (p-value > 0.05; доверительный интервал пересекает 0)
- распределение revenue имеет длинный хвост, и редкие большие значения могут заметно влиять на среднее
- после ограничения хвоста (по p99) эффект становится ближе к нулю, то есть разница средних чувствительна к редким большим значениям

**Решение:** на основании этого эксперимента внедрять фичу нельзя. Чтобы принять решение, нужен больший объём данных/длительность теста или заранее зафиксированное правило работы с хвостом (какую именно метрику/обработку используем) и повторная оценка
